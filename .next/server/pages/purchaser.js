(()=>{var e={};e.id=745,e.ids=[220,636,745],e.modules={237:(e,t)=>{"use strict";Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},310:(e,t,r)=>{"use strict";let s;function i(){if(!s){let{initializeApp:e,getApps:t,cert:i}=r(4715);s=t().length?t()[0]:e({credential:i({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")})})}return s}e.exports={getAuth:function(){return i(),r(922).getAuth()},getFirestore:function(){return i(),r(1965).getFirestore()}}},361:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},922:e=>{"use strict";e.exports=require("firebase-admin/auth")},979:()=>{},1413:(e,t)=>{"use strict";Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1934:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>h,default:()=>l,getServerSideProps:()=>g,getStaticPaths:()=>m,getStaticProps:()=>p,reportWebVitals:()=>f,routeModule:()=>v,unstable_getServerProps:()=>S,unstable_getServerSideProps:()=>j,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>x});var i=r(3885),n=r(237),o=r(1413),a=r(5425),u=r(6047),c=r(9373),d=e([u,c]);[u,c]=d.then?(await d)():d;let l=(0,o.M)(c,"default"),p=(0,o.M)(c,"getStaticProps"),m=(0,o.M)(c,"getStaticPaths"),g=(0,o.M)(c,"getServerSideProps"),h=(0,o.M)(c,"config"),f=(0,o.M)(c,"reportWebVitals"),x=(0,o.M)(c,"unstable_getStaticProps"),b=(0,o.M)(c,"unstable_getStaticPaths"),y=(0,o.M)(c,"unstable_getStaticParams"),S=(0,o.M)(c,"unstable_getServerProps"),j=(0,o.M)(c,"unstable_getServerSideProps"),v=new i.PagesRouteModule({definition:{kind:n.A.PAGES,page:"/purchaser",pathname:"/purchaser",bundlePath:"",filename:""},components:{App:u.default,Document:a.default},userland:c});s()}catch(e){s(e)}})},1965:e=>{"use strict";e.exports=require("firebase-admin/firestore")},2015:e=>{"use strict";e.exports=require("react")},2326:e=>{"use strict";e.exports=require("react-dom")},2474:()=>{},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4337:e=>{"use strict";e.exports=import("firebase/firestore")},4715:e=>{"use strict";e.exports=require("firebase-admin/app")},5425:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(8732),i=r(2341);function n(){return(0,s.jsxs)(i.Html,{lang:"en",children:[(0,s.jsx)(i.Head,{}),(0,s.jsxs)("body",{className:"antialiased",children:[(0,s.jsx)(i.Main,{}),(0,s.jsx)(i.NextScript,{})]})]})}},5492:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{As:()=>c,OJ:()=>d});var i=r(8732),n=r(2015),o=r(9582),a=r(6958),u=e([o,a]);[o,a]=u.then?(await u)():u;let l=(0,n.createContext)({});function c(){return(0,n.useContext)(l)}function d({children:e}){let[t,r]=(0,n.useState)(null),[s,u]=(0,n.useState)(!0),c=async()=>{console.log("[AuthContext] Logging out..."),await fetch("/api/sessionLogout",{method:"POST"}),await (0,a.signOut)(o.j2),console.log("[AuthContext] Signed out from Firebase Auth")};return(0,i.jsx)(l.Provider,{value:{currentUser:t,loading:s,logout:c},children:e})}s()}catch(e){s(e)}})},6047:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>d});var i=r(8732);r(979);var n=r(5492),o=r(4233),a=r(2015);r(2474);var u=e([n]);function c(){let{currentUser:e,logout:t}=(0,n.As)(),r=(0,o.useRouter)(),[s,u]=(0,a.useState)(!1);console.log("[Navbar] currentUser:",e);let c=["/login","/signup"].includes(r.pathname);if(!s||c)return null;let d=async()=>{await t(),r.push("/login")};return(0,i.jsxs)("nav",{className:"w-full bg-white border-b border-gray-200 px-2 py-2 md:px-8 flex flex-col md:flex-row items-center justify-between sticky top-0 z-50",children:[(0,i.jsx)("div",{className:"font-bold text-indigo-700 text-xl cursor-pointer mb-2 md:mb-0",onClick:()=>r.push("/"),children:"FleetFras"}),e&&(0,i.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-2 md:gap-4 w-full md:w-auto",children:[(0,i.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-1 bg-gray-100 rounded-md px-3 py-1 border border-gray-200 text-gray-900 text-sm font-medium w-full md:w-auto",children:[(0,i.jsx)("span",{className:"font-semibold",children:e.displayName||"No Name"}),(0,i.jsx)("span",{className:"text-indigo-600 text-xs md:ml-2 break-all",children:e.email})]}),(0,i.jsx)("button",{className:"w-full md:w-auto px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md font-medium text-sm",onClick:()=>r.push("/"),children:"Home"}),(0,i.jsx)("button",{className:"w-full md:w-auto px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium text-sm",onClick:d,children:"Logout"})]})]})}function d({Component:e,pageProps:t}){return(0,i.jsxs)(n.OJ,{children:[(0,i.jsx)(c,{}),(0,i.jsx)(e,{...t})]})}n=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},6472:e=>{"use strict";e.exports=require("@opentelemetry/api")},6551:e=>{"use strict";e.exports=import("firebase/app")},6958:e=>{"use strict";e.exports=import("firebase/auth")},7910:e=>{"use strict";e.exports=require("stream")},8732:e=>{"use strict";e.exports=require("react/jsx-runtime")},9021:e=>{"use strict";e.exports=require("fs")},9373:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>p,getServerSideProps:()=>l});var i=r(8732),n=r(5492),o=r(4233),a=r(2015),u=r(9582),c=r(4337),d=e([n,u,c]);async function l(e){let t=r(9964);t.default&&(t=t.default);let s=r(310);try{let r=t.get(e).session||"";if(!r)return{redirect:{destination:"/login",permanent:!1}};let i=await s.getAuth().verifySessionCookie(r,!0),n=s.getFirestore(),o=(await n.collection("users").doc(i.uid).get()).data();if(console.log("SSR: UID:",i.uid,"userData:",o),!o||!o.role||"purchaser"!==o.role.toLowerCase())return{redirect:{destination:"/login",permanent:!1}};return{props:{}}}catch(e){return console.error("SSR error:",e),{redirect:{destination:"/login",permanent:!1}}}}function p(){let{currentUser:e,logout:t}=(0,n.As)(),r=(0,o.useRouter)(),[s,d]=(0,a.useState)(null),[l,p]=(0,a.useState)(!0),[m,g]=(0,a.useState)("purchaser"),h=async()=>{if(e)try{await (0,c.addDoc)((0,c.collection)(u.db,"roleRequests"),{userId:e.uid,email:e.email,status:"pending",createdAt:new Date().toISOString()}),d("pending")}catch(e){alert("Failed to submit request")}},f=async()=>{e&&(await (0,c.updateDoc)((0,c.doc)(u.db,"users",e.uid),{role:"renter"}),r.push("/renter"))};return(0,i.jsxs)("div",{style:{padding:"2rem",minHeight:"100vh",background:"#f3f4f6"},children:[(0,i.jsx)("div",{style:{maxWidth:600,margin:"2rem auto"},children:(0,i.jsxs)("div",{style:{background:"#fff",borderRadius:12,boxShadow:"0 2px 12px rgba(0,0,0,0.10)",padding:"2rem",color:"#222"},children:[(0,i.jsx)("h1",{style:{marginBottom:"0.5rem",color:"#222"},children:"Welcome to the Purchaser Dashboard!"}),(0,i.jsxs)("p",{style:{marginBottom:"2rem",color:"#444"},children:["Your role: ",(0,i.jsx)("strong",{children:"purchaser"})]}),(0,i.jsx)("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem"},children:(0,i.jsx)("button",{style:{padding:"0.75rem 1.5rem",fontSize:"1rem",background:"#4f46e5",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:500},onClick:()=>r.push("/purchaser/posts"),children:"\uD83D\uDD0D View Available Posts"})}),"purchaser"===m&&(0,i.jsx)("button",{style:{marginTop:16,padding:"0.5rem 1.2rem",background:"#6366f1",color:"#fff",border:"none",borderRadius:6,fontWeight:500,cursor:"pointer"},onClick:f,children:"Switch to Renter"}),(0,i.jsx)("div",{style:{marginTop:"2rem"},children:l?(0,i.jsx)("p",{children:"Loading role switch status..."}):"pending"===s?(0,i.jsxs)("p",{children:["Your request to become a renter is ",(0,i.jsx)("strong",{children:"pending approval"}),"."]}):"approved"===s?(0,i.jsxs)("p",{children:["Your request to become a renter has been ",(0,i.jsx)("strong",{children:"approved"}),"."]}):"rejected"===s?(0,i.jsxs)("p",{children:["Your request to become a renter was ",(0,i.jsx)("strong",{children:"rejected"}),"."]}):(0,i.jsx)("button",{onClick:h,style:{padding:"0.5rem 1rem",fontSize:"1rem",background:"#6366f1",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:500},children:"Request to become a Renter"})})]})}),(0,i.jsx)("div",{style:{position:"fixed",bottom:32,right:32,zIndex:1e3},children:(0,i.jsx)("button",{style:{background:"#4f46e5",color:"#fff",border:"none",borderRadius:"50%",width:60,height:60,fontSize:28,boxShadow:"0 4px 16px rgba(79,70,229,0.15)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700},onClick:()=>r.push("/purchaser/chats"),title:"Support Chat",children:"\uD83D\uDCAC"})})]})}[n,u,c]=d.then?(await d)():d,s()}catch(e){s(e)}})},9582:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{G6:()=>p,db:()=>d,j2:()=>c});var i=r(6551),n=r(6958),o=r(4337),a=e([i,n,o]);[i,n,o]=a.then?(await a)():a;let u=(0,i.initializeApp)({apiKey:"AIzaSyDsXS1vhUGDVZVaFR_XKpdhzQAzLTyV6kg",authDomain:"car-management-system-d6ff2.firebaseapp.com",projectId:"car-management-system-d6ff2",storageBucket:"car-management-system-d6ff2.firebasestorage.app",messagingSenderId:"07165218280",appId:"1:707165218280:web:7e719544c58d5b49f1f05d"}),c=(0,n.getAuth)(u),d=(0,o.getFirestore)(u),l=new n.GoogleAuthProvider,p=async()=>{try{let e=await (0,n.signInWithPopup)(c,l);n.GoogleAuthProvider.credentialFromResult(e).accessToken;let t=e.user;return(await (0,o.getDoc)((0,o.doc)(d,"users",t.uid))).exists()||await (0,o.setDoc)((0,o.doc)(d,"users",t.uid),{email:t.email,name:t.displayName,role:"purchaser",createdAt:new Date().toISOString()}),t}catch(e){throw console.error("Error signing in with Google:",e),e}};s()}catch(e){s(e)}})},9964:e=>{"use strict";e.exports=require("nookies")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89,233,722],()=>r(1934));module.exports=s})();