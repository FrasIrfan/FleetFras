(()=>{var e={};e.id=332,e.ids=[220,332,636],e.modules={237:(e,t)=>{"use strict";Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},310:(e,t,r)=>{"use strict";let s;function i(){if(!s){let{initializeApp:e,getApps:t,cert:i}=r(4715);s=t().length?t()[0]:e({credential:i({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")})})}return s}e.exports={getAuth:function(){return i(),r(922).getAuth()},getFirestore:function(){return i(),r(1965).getFirestore()}}},361:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},922:e=>{"use strict";e.exports=require("firebase-admin/auth")},979:()=>{},1413:(e,t)=>{"use strict";Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1815:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>f,default:()=>d,getServerSideProps:()=>g,getStaticPaths:()=>m,getStaticProps:()=>p,reportWebVitals:()=>x,routeModule:()=>v,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>P,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>h});var i=r(3885),a=r(237),n=r(1413),o=r(5425),u=r(6047),c=r(8149),l=e([u,c]);[u,c]=l.then?(await l)():l;let d=(0,n.M)(c,"default"),p=(0,n.M)(c,"getStaticProps"),m=(0,n.M)(c,"getStaticPaths"),g=(0,n.M)(c,"getServerSideProps"),f=(0,n.M)(c,"config"),x=(0,n.M)(c,"reportWebVitals"),h=(0,n.M)(c,"unstable_getStaticProps"),b=(0,n.M)(c,"unstable_getStaticPaths"),P=(0,n.M)(c,"unstable_getStaticParams"),y=(0,n.M)(c,"unstable_getServerProps"),S=(0,n.M)(c,"unstable_getServerSideProps"),v=new i.PagesRouteModule({definition:{kind:a.A.PAGES,page:"/index",pathname:"/",bundlePath:"",filename:""},components:{App:u.default,Document:o.default},userland:c});s()}catch(e){s(e)}})},1965:e=>{"use strict";e.exports=require("firebase-admin/firestore")},2015:e=>{"use strict";e.exports=require("react")},2326:e=>{"use strict";e.exports=require("react-dom")},2474:()=>{},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4337:e=>{"use strict";e.exports=import("firebase/firestore")},4715:e=>{"use strict";e.exports=require("firebase-admin/app")},5425:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(8732),i=r(2341);function a(){return(0,s.jsxs)(i.Html,{lang:"en",children:[(0,s.jsx)(i.Head,{}),(0,s.jsxs)("body",{className:"antialiased",children:[(0,s.jsx)(i.Main,{}),(0,s.jsx)(i.NextScript,{})]})]})}},5492:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{As:()=>c,OJ:()=>l});var i=r(8732),a=r(2015),n=r(9582),o=r(6958),u=e([n,o]);[n,o]=u.then?(await u)():u;let d=(0,a.createContext)({});function c(){return(0,a.useContext)(d)}function l({children:e}){let[t,r]=(0,a.useState)(null),[s,u]=(0,a.useState)(!0),c=async()=>{console.log("[AuthContext] Logging out..."),await fetch("/api/sessionLogout",{method:"POST"}),await (0,o.signOut)(n.j2),console.log("[AuthContext] Signed out from Firebase Auth")};return(0,i.jsx)(d.Provider,{value:{currentUser:t,loading:s,logout:c},children:e})}s()}catch(e){s(e)}})},6047:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>l});var i=r(8732);r(979);var a=r(5492),n=r(4233),o=r(2015);r(2474);var u=e([a]);function c(){let{currentUser:e,logout:t}=(0,a.As)(),r=(0,n.useRouter)(),[s,u]=(0,o.useState)(!1);console.log("[Navbar] currentUser:",e);let c=["/login","/signup"].includes(r.pathname);if(!s||c)return null;let l=async()=>{await t(),r.push("/login")};return(0,i.jsxs)("nav",{className:"w-full bg-white border-b border-gray-200 px-2 py-2 md:px-8 flex flex-col md:flex-row items-center justify-between sticky top-0 z-50",children:[(0,i.jsx)("div",{className:"font-bold text-indigo-700 text-xl cursor-pointer mb-2 md:mb-0",onClick:()=>r.push("/"),children:"FleetFras"}),e&&(0,i.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-2 md:gap-4 w-full md:w-auto",children:[(0,i.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-1 bg-gray-100 rounded-md px-3 py-1 border border-gray-200 text-gray-900 text-sm font-medium w-full md:w-auto",children:[(0,i.jsx)("span",{className:"font-semibold",children:e.displayName||"No Name"}),(0,i.jsx)("span",{className:"text-indigo-600 text-xs md:ml-2 break-all",children:e.email})]}),(0,i.jsx)("button",{className:"w-full md:w-auto px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md font-medium text-sm",onClick:()=>r.push("/"),children:"Home"}),(0,i.jsx)("button",{className:"w-full md:w-auto px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium text-sm",onClick:l,children:"Logout"})]})]})}function l({Component:e,pageProps:t}){return(0,i.jsxs)(a.OJ,{children:[(0,i.jsx)(c,{}),(0,i.jsx)(e,{...t})]})}a=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},6472:e=>{"use strict";e.exports=require("@opentelemetry/api")},6551:e=>{"use strict";e.exports=import("firebase/app")},6958:e=>{"use strict";e.exports=import("firebase/auth")},7910:e=>{"use strict";e.exports=require("stream")},8149:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>d,getServerSideProps:()=>l});var i=r(8732);r(2015);var a=r(4233),n=r(5492),o=r(4337),u=r(9582),c=e([n,o,u]);async function l(e){let t=r(9964);t.default&&(t=t.default);let s=r(310);try{let r=t.get(e).session||"";if(!r)return{redirect:{destination:"/login",permanent:!1}};let i=await s.getAuth().verifySessionCookie(r,!0),a=s.getFirestore(),n=(await a.collection("users").doc(i.uid).get()).data();if(!n||!n.role)return{redirect:{destination:"/purchaser",permanent:!1}};if("admin"===n.role.toLowerCase())return{redirect:{destination:"/admin",permanent:!1}};if("renter"===n.role.toLowerCase())return{redirect:{destination:"/renter",permanent:!1}};else return{redirect:{destination:"/purchaser",permanent:!1}}}catch(e){return{redirect:{destination:"/login",permanent:!1}}}}function d(){let{currentUser:e,loading:t}=(0,n.As)();return(0,a.useRouter)(),(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})})}[n,o,u]=c.then?(await c)():c,s()}catch(e){s(e)}})},8732:e=>{"use strict";e.exports=require("react/jsx-runtime")},9021:e=>{"use strict";e.exports=require("fs")},9582:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{G6:()=>p,db:()=>l,j2:()=>c});var i=r(6551),a=r(6958),n=r(4337),o=e([i,a,n]);[i,a,n]=o.then?(await o)():o;let u=(0,i.initializeApp)({apiKey:"AIzaSyDsXS1vhUGDVZVaFR_XKpdhzQAzLTyV6kg",authDomain:"car-management-system-d6ff2.firebaseapp.com",projectId:"car-management-system-d6ff2",storageBucket:"car-management-system-d6ff2.firebasestorage.app",messagingSenderId:"07165218280",appId:"1:707165218280:web:7e719544c58d5b49f1f05d"}),c=(0,a.getAuth)(u),l=(0,n.getFirestore)(u),d=new a.GoogleAuthProvider,p=async()=>{try{let e=await (0,a.signInWithPopup)(c,d);a.GoogleAuthProvider.credentialFromResult(e).accessToken;let t=e.user;return(await (0,n.getDoc)((0,n.doc)(l,"users",t.uid))).exists()||await (0,n.setDoc)((0,n.doc)(l,"users",t.uid),{email:t.email,name:t.displayName,role:"purchaser",createdAt:new Date().toISOString()}),t}catch(e){throw console.error("Error signing in with Google:",e),e}};s()}catch(e){s(e)}})},9964:e=>{"use strict";e.exports=require("nookies")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89,233,722],()=>r(1815));module.exports=s})();