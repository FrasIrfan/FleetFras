(()=>{var e={};e.id=309,e.ids=[220,309,636],e.modules={237:(e,t)=>{"use strict";Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},310:(e,t,r)=>{"use strict";let s;function a(){if(!s){let{initializeApp:e,getApps:t,cert:a}=r(4715);s=t().length?t()[0]:e({credential:a({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")})})}return s}e.exports={getAuth:function(){return a(),r(922).getAuth()},getFirestore:function(){return a(),r(1965).getFirestore()}}},361:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},750:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>g,default:()=>u,getServerSideProps:()=>x,getStaticPaths:()=>p,getStaticProps:()=>m,reportWebVitals:()=>h,routeModule:()=>v,unstable_getServerProps:()=>j,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>f});var a=r(3885),i=r(237),o=r(1413),n=r(5425),d=r(6047),l=r(6525),c=e([d,l]);[d,l]=c.then?(await c)():c;let u=(0,o.M)(l,"default"),m=(0,o.M)(l,"getStaticProps"),p=(0,o.M)(l,"getStaticPaths"),x=(0,o.M)(l,"getServerSideProps"),g=(0,o.M)(l,"config"),h=(0,o.M)(l,"reportWebVitals"),f=(0,o.M)(l,"unstable_getStaticProps"),b=(0,o.M)(l,"unstable_getStaticPaths"),y=(0,o.M)(l,"unstable_getStaticParams"),j=(0,o.M)(l,"unstable_getServerProps"),w=(0,o.M)(l,"unstable_getServerSideProps"),v=new a.PagesRouteModule({definition:{kind:i.A.PAGES,page:"/admin",pathname:"/admin",bundlePath:"",filename:""},components:{App:d.default,Document:n.default},userland:l});s()}catch(e){s(e)}})},922:e=>{"use strict";e.exports=require("firebase-admin/auth")},979:()=>{},1413:(e,t)=>{"use strict";Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1965:e=>{"use strict";e.exports=require("firebase-admin/firestore")},2015:e=>{"use strict";e.exports=require("react")},2326:e=>{"use strict";e.exports=require("react-dom")},2474:()=>{},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4337:e=>{"use strict";e.exports=import("firebase/firestore")},4715:e=>{"use strict";e.exports=require("firebase-admin/app")},5425:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(8732),a=r(2341);function i(){return(0,s.jsxs)(a.Html,{lang:"en",children:[(0,s.jsx)(a.Head,{}),(0,s.jsxs)("body",{className:"antialiased",children:[(0,s.jsx)(a.Main,{}),(0,s.jsx)(a.NextScript,{})]})]})}},5492:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{As:()=>l,OJ:()=>c});var a=r(8732),i=r(2015),o=r(9582),n=r(6958),d=e([o,n]);[o,n]=d.then?(await d)():d;let u=(0,i.createContext)({});function l(){return(0,i.useContext)(u)}function c({children:e}){let[t,r]=(0,i.useState)(null),[s,d]=(0,i.useState)(!0),l=async()=>{console.log("[AuthContext] Logging out..."),await fetch("/api/sessionLogout",{method:"POST"}),await (0,n.signOut)(o.j2),console.log("[AuthContext] Signed out from Firebase Auth")};return(0,a.jsx)(u.Provider,{value:{currentUser:t,loading:s,logout:l},children:e})}s()}catch(e){s(e)}})},6047:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>c});var a=r(8732);r(979);var i=r(5492),o=r(4233),n=r(2015);r(2474);var d=e([i]);function l(){let{currentUser:e,logout:t}=(0,i.As)(),r=(0,o.useRouter)(),[s,d]=(0,n.useState)(!1);console.log("[Navbar] currentUser:",e);let l=["/login","/signup"].includes(r.pathname);if(!s||l)return null;let c=async()=>{await t(),r.push("/login")};return(0,a.jsxs)("nav",{className:"w-full bg-white border-b border-gray-200 px-2 py-2 md:px-8 flex flex-col md:flex-row items-center justify-between sticky top-0 z-50",children:[(0,a.jsx)("div",{className:"font-bold text-indigo-700 text-xl cursor-pointer mb-2 md:mb-0",onClick:()=>r.push("/"),children:"FleetFras"}),e&&(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-2 md:gap-4 w-full md:w-auto",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-1 bg-gray-100 rounded-md px-3 py-1 border border-gray-200 text-gray-900 text-sm font-medium w-full md:w-auto",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.displayName||"No Name"}),(0,a.jsx)("span",{className:"text-indigo-600 text-xs md:ml-2 break-all",children:e.email})]}),(0,a.jsx)("button",{className:"w-full md:w-auto px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md font-medium text-sm",onClick:()=>r.push("/"),children:"Home"}),(0,a.jsx)("button",{className:"w-full md:w-auto px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium text-sm",onClick:c,children:"Logout"})]})]})}function c({Component:e,pageProps:t}){return(0,a.jsxs)(i.OJ,{children:[(0,a.jsx)(l,{}),(0,a.jsx)(e,{...t})]})}i=(d.then?(await d)():d)[0],s()}catch(e){s(e)}})},6472:e=>{"use strict";e.exports=require("@opentelemetry/api")},6525:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>u,getServerSideProps:()=>m});var a=r(8732),i=r(5492),o=r(2015),n=r(9582),d=r(4337),l=r(4233),c=e([i,n,d]);function u(){let{currentUser:e,logout:t}=(0,i.As)(),r=(0,l.useRouter)(),[s,c]=(0,o.useState)([]),[u,m]=(0,o.useState)(!0),p=async e=>{try{await (0,d.updateDoc)((0,d.doc)(n.db,"users",e.userId),{role:"renter"}),await (0,d.updateDoc)((0,d.doc)(n.db,"roleRequests",e.id),{status:"approved"}),c(t=>t.map(t=>t.id===e.id?{...t,status:"approved"}:t)),console.log("[AdminDashboard] Approved request:",e)}catch(e){alert("Failed to approve request"),console.error("[AdminDashboard] Error approving request:",e)}},x=async e=>{try{await (0,d.updateDoc)((0,d.doc)(n.db,"roleRequests",e.id),{status:"rejected"}),c(t=>t.map(t=>t.id===e.id?{...t,status:"rejected"}:t)),console.log("[AdminDashboard] Rejected request:",e)}catch(e){alert("Failed to reject request"),console.error("[AdminDashboard] Error rejecting request:",e)}};return console.log("[AdminDashboard] currentUser:",e),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100 p-2 md:p-6 flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"w-full max-w-2xl md:max-w-3xl bg-white rounded-2xl shadow-xl p-4 md:p-8 mt-4",children:[(0,a.jsx)("h1",{className:"mb-2 text-xl md:text-2xl font-bold text-gray-900",children:"Welcome to the Admin Dashboard!"}),(0,a.jsxs)("p",{className:"mb-6 text-gray-700",children:["Your role: ",(0,a.jsx)("span",{className:"font-semibold",children:"admin"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("button",{className:"px-4 py-2 text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg font-medium w-full md:w-auto",onClick:()=>r.push("/admin/posts"),children:"\uD83D\uDCDD Manage Posts"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Role Switch Requests"}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border border-gray-200 bg-gray-50",children:u?(0,a.jsx)("p",{className:"p-4 text-center text-gray-500",children:"Loading requests..."}):0===s.length?(0,a.jsx)("p",{className:"p-4 text-center text-gray-500",children:"No role switch requests found."}):(0,a.jsxs)("table",{className:"min-w-full text-sm text-left",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"px-4 py-2 font-semibold text-gray-700",children:"Email"}),(0,a.jsx)("th",{className:"px-4 py-2 font-semibold text-gray-700",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-2 font-semibold text-gray-700",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:s.map((e,t)=>(0,a.jsxs)("tr",{className:t%2==0?"bg-white":"bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 break-all text-black",children:e.email}),(0,a.jsx)("td",{className:`px-4 py-2 font-semibold ${"approved"===e.status?"text-green-600":"rejected"===e.status?"text-red-600":"text-orange-500"}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),(0,a.jsx)("td",{className:"px-4 py-2 space-x-2",children:"pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>p(e),className:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md mb-1 md:mb-0",children:"Approve"}),(0,a.jsx)("button",{onClick:()=>x(e),className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded-md",children:"Reject"})]})})]},e.id))})]})})]})]}),(0,a.jsx)("div",{style:{position:"fixed",bottom:32,right:32,zIndex:1e3},children:(0,a.jsx)("button",{style:{background:"#4f46e5",color:"#fff",border:"none",borderRadius:"50%",width:60,height:60,fontSize:28,boxShadow:"0 4px 16px rgba(79,70,229,0.15)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700},onClick:()=>{console.log("[AdminDashboard] Floating chat button clicked"),r.push("/admin/chats").catch(e=>{console.error("Router push error:",e),window.location.href="/admin/chats"})},title:"Admin Chats",children:"\uD83D\uDCAC"})})]})}async function m(e){let t=r(9964);t.default&&(t=t.default);let s=r(310);try{let r=t.get(e).session||"";if(!r)return{redirect:{destination:"/login",permanent:!1}};let a=await s.getAuth().verifySessionCookie(r,!0),i=s.getFirestore(),o=(await i.collection("users").doc(a.uid).get()).data();if(console.log("SSR: UID:",a.uid,"userData:",o),!o||!o.role||"admin"!==o.role.toLowerCase())return{redirect:{destination:"/login",permanent:!1}};return{props:{}}}catch(e){return console.error("SSR error:",e),{redirect:{destination:"/login",permanent:!1}}}}[i,n,d]=c.then?(await c)():c,s()}catch(e){s(e)}})},6551:e=>{"use strict";e.exports=import("firebase/app")},6958:e=>{"use strict";e.exports=import("firebase/auth")},7910:e=>{"use strict";e.exports=require("stream")},8732:e=>{"use strict";e.exports=require("react/jsx-runtime")},9021:e=>{"use strict";e.exports=require("fs")},9582:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{G6:()=>m,db:()=>c,j2:()=>l});var a=r(6551),i=r(6958),o=r(4337),n=e([a,i,o]);[a,i,o]=n.then?(await n)():n;let d=(0,a.initializeApp)({apiKey:"AIzaSyDsXS1vhUGDVZVaFR_XKpdhzQAzLTyV6kg",authDomain:"car-management-system-d6ff2.firebaseapp.com",projectId:"car-management-system-d6ff2",storageBucket:"car-management-system-d6ff2.firebasestorage.app",messagingSenderId:"07165218280",appId:"1:707165218280:web:7e719544c58d5b49f1f05d"}),l=(0,i.getAuth)(d),c=(0,o.getFirestore)(d),u=new i.GoogleAuthProvider,m=async()=>{try{let e=await (0,i.signInWithPopup)(l,u);i.GoogleAuthProvider.credentialFromResult(e).accessToken;let t=e.user;return(await (0,o.getDoc)((0,o.doc)(c,"users",t.uid))).exists()||await (0,o.setDoc)((0,o.doc)(c,"users",t.uid),{email:t.email,name:t.displayName,role:"purchaser",createdAt:new Date().toISOString()}),t}catch(e){throw console.error("Error signing in with Google:",e),e}};s()}catch(e){s(e)}})},9964:e=>{"use strict";e.exports=require("nookies")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89,233,722],()=>r(750));module.exports=s})();