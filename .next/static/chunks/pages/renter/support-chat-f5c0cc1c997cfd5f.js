(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[915],{2550:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/renter/support-chat",function(){return t(8795)}])},8795:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var d=t(7876),s=t(1898),n=t(4232),i=t(4234),a=t(2009);function l(){let{currentUser:e}=(0,s.As)(),[r,t]=(0,n.useState)([]),[l,o]=(0,n.useState)(""),[u,c]=(0,n.useState)(null),f=(0,n.useRef)(null);(0,n.useEffect)(()=>{let r;if(e)return(async()=>{let d=(0,a.P)((0,a.rJ)(i.db,"chats"),(0,a._M)("userId","==",e.uid),(0,a._M)("userRole","==","renter")),s=await (0,a.GG)(d);if(s.empty){let d=await (0,a.gS)((0,a.rJ)(i.db,"chats"),{userId:e.uid,userRole:"renter",messages:[]});c(d.id),r=(0,a.aQ)((0,a.H9)(i.db,"chats",d.id),e=>{var r;t((null==(r=e.data())?void 0:r.messages)||[])})}else{let e=s.docs[0];c(e.id),r=(0,a.aQ)((0,a.H9)(i.db,"chats",e.id),e=>{var r;t((null==(r=e.data())?void 0:r.messages)||[])})}})(),()=>r&&r()},[e]),(0,n.useEffect)(()=>{var e;null==(e=f.current)||e.scrollIntoView({behavior:"smooth"})},[r]);let m=async()=>{if(!l.trim()||!u)return;let e={sender:"renter",text:l,timestamp:Date.now()},t=(0,a.H9)(i.db,"chats",u);await (0,a.mZ)(t,{messages:[...r,e]}),o("")};return(0,d.jsx)("div",{style:{padding:"2rem",minHeight:"100vh",background:"#f3f4f6",display:"flex",flexDirection:"column",alignItems:"center"},children:(0,d.jsxs)("div",{style:{width:"100%",maxWidth:500,background:"#fff",borderRadius:12,boxShadow:"0 2px 12px rgba(0,0,0,0.10)",padding:"2rem",color:"#222",display:"flex",flexDirection:"column",height:600},children:[(0,d.jsx)("h2",{style:{marginBottom:16,color:"#4f46e5"},children:"Support Chat"}),(0,d.jsxs)("div",{style:{flex:1,overflowY:"auto",marginBottom:16,background:"#f9fafb",borderRadius:8,padding:12,border:"1px solid #eee"},children:[0===r.length?(0,d.jsx)("p",{style:{color:"#888"},children:"No messages yet."}):r.map((e,r)=>(0,d.jsxs)("div",{style:{marginBottom:10,textAlign:"admin"===e.sender?"right":"left"},children:[(0,d.jsx)("div",{style:{fontSize:12,color:"#888",marginBottom:2,textAlign:"admin"===e.sender?"right":"left"},children:"admin"===e.sender?"Admin:":"You:"}),(0,d.jsx)("span",{style:{display:"inline-block",background:"admin"===e.sender?"#4f46e5":"#e0e7ff",color:"admin"===e.sender?"#fff":"#222",borderRadius:16,padding:"0.5rem 1rem",fontWeight:500,maxWidth:"70%",wordBreak:"break-word"},children:e.text})]},r)),(0,d.jsx)("div",{ref:f})]}),(0,d.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,d.jsx)("input",{type:"text",value:l,onChange:e=>o(e.target.value),placeholder:"Type your message...",style:{flex:1,padding:"0.75rem",borderRadius:8,border:"1px solid #bbb",fontSize:"1rem"},onKeyDown:e=>{"Enter"===e.key&&m()}}),(0,d.jsx)("button",{onClick:m,style:{padding:"0.75rem 1.5rem",background:"#4f46e5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"Send"})]})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[636,593,792],()=>r(2550)),_N_E=e.O()}]);