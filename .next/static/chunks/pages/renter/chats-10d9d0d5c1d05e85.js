(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[536],{1634:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/renter/chats",function(){return i(3120)}])},3120:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var r=i(7876),d=i(1898),s=i(4232),o=i(4234),n=i(2009);function l(){var e,t;let{currentUser:i}=(0,d.As)(),[l,a]=(0,s.useState)([]),[c,u]=(0,s.useState)(null),[f,h]=(0,s.useState)([]),[g,p]=(0,s.useState)(""),[x,m]=(0,s.useState)({}),y=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e;if(i)return(async()=>{let e=await (0,n.GG)((0,n.P)((0,n.rJ)(o.db,"posts"),(0,n._M)("ownerId","==",i.uid))),t={},r=[];if(e.docs.forEach(e=>{t[e.id]={id:e.id,...e.data()},r.push(e.id)}),m(t),0===r.length)return a([]);a((await (0,n.GG)((0,n.P)((0,n.rJ)(o.db,"chats"),(0,n._M)("postId","in",r)))).docs.map(e=>({id:e.id,...e.data()})))})(),()=>e&&e()},[i]),(0,s.useEffect)(()=>{if(!c)return;let e=(0,n.aQ)((0,n.H9)(o.db,"chats",c.id),e=>{var t;h((null==(t=e.data())?void 0:t.messages)||[])});return()=>e()},[c]),(0,s.useEffect)(()=>{var e;null==(e=y.current)||e.scrollIntoView({behavior:"smooth"})},[f]);let b=async()=>{if(!g.trim()||!c)return;let e={sender:i.uid,text:g,timestamp:Date.now()},t=(0,n.H9)(o.db,"chats",c.id);await (0,n.mZ)(t,{messages:[...f,e]}),p("")};return(0,r.jsx)("div",{style:{padding:"2rem",minHeight:"100vh",background:"#f3f4f6",display:"flex",flexDirection:"column",alignItems:"center"},children:(0,r.jsxs)("div",{style:{width:"100%",maxWidth:900,background:"#fff",borderRadius:12,boxShadow:"0 2px 12px rgba(0,0,0,0.10)",padding:"2rem",color:"#222",display:"flex",gap:32,minHeight:600},children:[(0,r.jsxs)("div",{style:{width:280,borderRight:"1px solid #eee",paddingRight:24},children:[(0,r.jsx)("h2",{style:{color:"#4f46e5",marginBottom:16},children:"Chats for Your Posts"}),0===l.length?(0,r.jsx)("p",{style:{color:"#888"},children:"No chats yet."}):l.map(e=>{var t;return(0,r.jsxs)("div",{style:{marginBottom:12,cursor:"pointer",background:(null==c?void 0:c.id)===e.id?"#e0e7ff":"#f9fafb",borderRadius:8,padding:12,border:"1px solid #eee"},onClick:()=>{u(e)},children:[(0,r.jsxs)("div",{style:{fontWeight:600,color:"#222"},children:["Post: ",(null==(t=x[e.postId])?void 0:t.title)||e.postId]}),(0,r.jsxs)("div",{style:{color:"#444",fontSize:14},children:["Purchaser: ",e.userId]}),(null==c?void 0:c.id)===e.id&&(0,r.jsx)("div",{style:{color:"#4f46e5",fontWeight:700,fontSize:12,marginTop:4},children:"Selected"})]},e.id)})]}),(0,r.jsx)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("h3",{style:{color:"#4f46e5",marginBottom:8},children:["Chat for Post: ",(null==(e=x[c.postId])?void 0:e.title)||c.postId]}),(0,r.jsx)("div",{style:{marginBottom:8,color:"#444",fontSize:15},children:null==(t=x[c.postId])?void 0:t.description}),(0,r.jsxs)("div",{style:{flex:1,overflowY:"auto",marginBottom:16,background:"#f9fafb",borderRadius:8,padding:12,border:"1px solid #eee",minHeight:300},children:[0===f.length?(0,r.jsx)("p",{style:{color:"#888"},children:"No messages yet."}):f.map((e,t)=>(0,r.jsxs)("div",{style:{marginBottom:10,textAlign:e.sender===i.uid?"right":"left"},children:[(0,r.jsx)("div",{style:{fontSize:12,color:"#888",marginBottom:2,textAlign:e.sender===i.uid?"right":"left"},children:e.sender===i.uid?"You:":"Purchaser:"}),(0,r.jsx)("span",{style:{display:"inline-block",background:e.sender===i.uid?"#4f46e5":"#e0e7ff",color:e.sender===i.uid?"#fff":"#222",borderRadius:16,padding:"0.5rem 1rem",fontWeight:500,maxWidth:"70%",wordBreak:"break-word"},children:e.text})]},t)),(0,r.jsx)("div",{ref:y})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsx)("input",{type:"text",value:g,onChange:e=>p(e.target.value),placeholder:"Type your message...",style:{flex:1,padding:"0.75rem",borderRadius:8,border:"1px solid #bbb",fontSize:"1rem"},onKeyDown:e=>{"Enter"===e.key&&b()}}),(0,r.jsx)("button",{onClick:b,style:{padding:"0.75rem 1.5rem",background:"#4f46e5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"Send"})]})]}):(0,r.jsx)("div",{style:{color:"#888",marginTop:100,textAlign:"center"},children:"Select a chat to view messages."})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(1634)),_N_E=e.O()}]);