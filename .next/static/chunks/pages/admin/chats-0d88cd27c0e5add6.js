(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[157],{5238:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chats",function(){return s(7717)}])},7717:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var r=s(7876),i=s(4232),d=s(4234),a=s(2009);function n(){let[e,t]=(0,i.useState)(!1),[s,n]=(0,i.useState)([]),[l,o]=(0,i.useState)(null),[c,m]=(0,i.useState)([]),[u,f]=(0,i.useState)(""),[g,h]=(0,i.useState)({}),x=(0,i.useRef)(null);(0,i.useEffect)(()=>{t(!0)},[]),(0,i.useEffect)(()=>{if(!e)return;let t=(0,a.aQ)((0,a.rJ)(d.db,"chats"),async e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));if(t.sort((e,t)=>{let s=e.messages&&e.messages.length>0?e.messages[e.messages.length-1].timestamp:e.createdAt?new Date(e.createdAt).getTime():0;return(t.messages&&t.messages.length>0?t.messages[t.messages.length-1].timestamp:t.createdAt?new Date(t.createdAt).getTime():0)-s}),n(t),[...new Set(t.map(e=>e.userId).filter(Boolean))].length>0){let e=await (0,a.GG)((0,a.rJ)(d.db,"users")),t={};e.forEach(e=>{let s=e.data();t[e.id]={name:s.displayName||s.name||"No Name",email:s.email||""}}),h(t)}});return()=>t()},[e]),(0,i.useEffect)(()=>{if(!l)return;let e=(0,a.aQ)((0,a.H9)(d.db,"chats",l.id),e=>{var t;m((null==(t=e.data())?void 0:t.messages)||[])});return()=>e()},[l]),(0,i.useEffect)(()=>{var e;null==(e=x.current)||e.scrollIntoView({behavior:"smooth"})},[c]);let p=async()=>{if(!u.trim()||!l)return;let e={sender:"admin",text:u,timestamp:Date.now()},t=(0,a.H9)(d.db,"chats",l.id);await (0,a.mZ)(t,{messages:[...c,e]}),f("")};return e?(0,r.jsx)("div",{style:{padding:"2rem",minHeight:"100vh",background:"#f3f4f6",display:"flex",flexDirection:"column",alignItems:"center"},children:(0,r.jsxs)("div",{style:{width:"100%",maxWidth:900,background:"#fff",borderRadius:12,boxShadow:"0 2px 12px rgba(0,0,0,0.10)",padding:"2rem",color:"#222",display:"flex",gap:32,minHeight:600},children:[(0,r.jsxs)("div",{style:{width:280,borderRight:"1px solid #eee",paddingRight:24},children:[(0,r.jsx)("h2",{style:{color:"#4f46e5",marginBottom:16},children:"All Chats"}),0===s.length?(0,r.jsx)("p",{style:{color:"#888"},children:"No chats yet."}):s.map(e=>{var t,s;return(0,r.jsxs)("div",{style:{marginBottom:12,cursor:"pointer",background:(null==l?void 0:l.id)===e.id?"#e0e7ff":"#f9fafb",borderRadius:8,padding:12,border:"1px solid #eee"},onClick:()=>o(e),children:[(0,r.jsx)("div",{style:{fontWeight:600,color:"#222"},children:(null==(t=g[e.userId])?void 0:t.name)||"User"}),(0,r.jsx)("div",{style:{color:"#444",fontSize:14},children:(null==(s=g[e.userId])?void 0:s.email)||e.userId})]},e.id)})]}),(0,r.jsx)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("h3",{style:{color:"#4f46e5",marginBottom:8},children:["Chat with ",l.userRole," (",l.userId,")"]}),(0,r.jsxs)("div",{style:{flex:1,overflowY:"auto",marginBottom:16,background:"#f9fafb",borderRadius:8,padding:12,border:"1px solid #eee"},children:[0===c.length?(0,r.jsx)("p",{style:{color:"#888"},children:"No messages yet."}):c.map((e,t)=>(0,r.jsx)("div",{style:{marginBottom:10,textAlign:"admin"===e.sender?"right":"left"},children:(0,r.jsx)("span",{style:{display:"inline-block",background:"admin"===e.sender?"#4f46e5":"#e0e7ff",color:"admin"===e.sender?"#fff":"#222",borderRadius:16,padding:"0.5rem 1rem",fontWeight:500,maxWidth:"70%",wordBreak:"break-word"},children:e.text})},t)),(0,r.jsx)("div",{ref:x})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsx)("input",{type:"text",value:u,onChange:e=>f(e.target.value),placeholder:"Type your message...",style:{flex:1,padding:"0.75rem",borderRadius:8,border:"1px solid #bbb",fontSize:"1rem"},onKeyDown:e=>{"Enter"===e.key&&p()}}),(0,r.jsx)("button",{onClick:p,style:{padding:"0.75rem 1.5rem",background:"#4f46e5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"Send"})]})]}):(0,r.jsx)("div",{style:{color:"#888",marginTop:100,textAlign:"center"},children:"Select a chat to view messages."})})]})}):(0,r.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(5238)),_N_E=e.O()}]);