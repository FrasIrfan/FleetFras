(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[157],{5238:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chats",function(){return t(7717)}])},7717:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var a=t(7876),r=t(4232),l=t(4234),n=t(2009);function d(){let[e,s]=(0,r.useState)(!1),[t,d]=(0,r.useState)([]),[i,m]=(0,r.useState)(null),[o,c]=(0,r.useState)([]),[g,u]=(0,r.useState)(""),[x,h]=(0,r.useState)({}),f=(0,r.useRef)(null);(0,r.useEffect)(()=>{s(!0)},[]),(0,r.useEffect)(()=>{if(!e)return;let s=(0,n.aQ)((0,n.rJ)(l.db,"chats"),async e=>{let s=e.docs.map(e=>({id:e.id,...e.data()}));if(s.sort((e,s)=>{let t=e.messages&&e.messages.length>0?e.messages[e.messages.length-1].timestamp:e.createdAt?new Date(e.createdAt).getTime():0;return(s.messages&&s.messages.length>0?s.messages[s.messages.length-1].timestamp:s.createdAt?new Date(s.createdAt).getTime():0)-t}),d(s),[...new Set(s.map(e=>e.userId).filter(Boolean))].length>0){let e=await (0,n.GG)((0,n.rJ)(l.db,"users")),s={};e.forEach(e=>{let t=e.data();s[e.id]={name:t.displayName||t.name||"No Name",email:t.email||""}}),h(s)}});return()=>s()},[e]),(0,r.useEffect)(()=>{if(!i)return;let e=(0,n.aQ)((0,n.H9)(l.db,"chats",i.id),e=>{var s;c((null==(s=e.data())?void 0:s.messages)||[])});return()=>e()},[i]),(0,r.useEffect)(()=>{var e;null==(e=f.current)||e.scrollIntoView({behavior:"smooth"})},[o]);let b=async()=>{if(!g.trim()||!i)return;let e={sender:"admin",text:g,timestamp:Date.now()},s=(0,n.H9)(l.db,"chats",i.id);await (0,n.mZ)(s,{messages:[...o,e]}),u("")};return e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 p-2 md:p-6 flex flex-col items-center",children:(0,a.jsxs)("div",{className:"w-full max-w-5xl bg-white rounded-2xl shadow-xl p-4 md:p-8 mt-4 flex flex-col md:flex-row gap-8 min-h-[600px]",children:[(0,a.jsxs)("div",{className:"w-full md:w-72 border-r border-gray-200 pr-0 md:pr-6 mb-6 md:mb-0",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-indigo-700 mb-4",children:"All Chats"}),0===t.length?(0,a.jsx)("p",{className:"text-gray-500",children:"No chats yet."}):t.map(e=>{var s,t;return(0,a.jsxs)("div",{className:"mb-3 cursor-pointer rounded-lg p-3 border ".concat((null==i?void 0:i.id)===e.id?"bg-indigo-100 border-indigo-400":"bg-gray-50 border-gray-200"),onClick:()=>m(e),children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:(null==(s=x[e.userId])?void 0:s.name)||"User"}),(0,a.jsx)("div",{className:"text-gray-600 text-xs break-all",children:(null==(t=x[e.userId])?void 0:t.email)||e.userId})]},e.id)})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("h3",{className:"text-indigo-700 font-semibold mb-2",children:["Chat with ",i.userRole," (",i.userId,")"]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 bg-gray-50 rounded-lg p-4 border border-gray-200 min-h-[300px]",children:[0===o.length?(0,a.jsx)("p",{className:"text-gray-500",children:"No messages yet."}):o.map((e,s)=>(0,a.jsx)("div",{className:"mb-2 flex ".concat("admin"===e.sender?"justify-end":"justify-start"),children:(0,a.jsx)("span",{className:"inline-block px-4 py-2 rounded-2xl font-medium max-w-[70%] break-words ".concat("admin"===e.sender?"bg-indigo-600 text-white":"bg-indigo-100 text-gray-900"),children:e.text})},s)),(0,a.jsx)("div",{ref:f})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsx)("input",{type:"text",value:g,onChange:e=>u(e.target.value),placeholder:"Type your message...",className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400",onKeyDown:e=>{"Enter"===e.key&&b()}}),(0,a.jsx)("button",{onClick:b,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold",children:"Send"})]})]}):(0,a.jsx)("div",{className:"text-gray-500 mt-20 text-center",children:"Select a chat to view messages."})})]})}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading..."})}}},e=>{var s=s=>e(e.s=s);e.O(0,[636,593,792],()=>s(5238)),_N_E=e.O()}]);