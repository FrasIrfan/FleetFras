(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[537],{881:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var s=t(7876),d=t(1898),a=t(4232),i=t(4234),n=t(2009);function l(){let{currentUser:e}=(0,d.As)(),[r,t]=(0,a.useState)([]),[l,o]=(0,a.useState)(""),[u,c]=(0,a.useState)(null),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{let r;if(e)return(async()=>{let s=(0,n.P)((0,n.rJ)(i.db,"chats"),(0,n._M)("userId","==",e.uid),(0,n._M)("userRole","==","purchaser")),d=await (0,n.GG)(s);if(d.empty){let s=await (0,n.gS)((0,n.rJ)(i.db,"chats"),{userId:e.uid,userRole:"purchaser",messages:[]});c(s.id),r=(0,n.aQ)((0,n.H9)(i.db,"chats",s.id),e=>{var r;t((null==(r=e.data())?void 0:r.messages)||[])})}else{let e=d.docs[0];c(e.id),r=(0,n.aQ)((0,n.H9)(i.db,"chats",e.id),e=>{var r;t((null==(r=e.data())?void 0:r.messages)||[])})}})(),()=>r&&r()},[e]),(0,a.useEffect)(()=>{var e;null==(e=f.current)||e.scrollIntoView({behavior:"smooth"})},[r]);let h=async()=>{if(!l.trim()||!u)return;let e={sender:"purchaser",text:l,timestamp:Date.now()},t=(0,n.H9)(i.db,"chats",u);await (0,n.mZ)(t,{messages:[...r,e]}),o("")};return(0,s.jsx)("div",{style:{padding:"2rem",minHeight:"100vh",background:"#f3f4f6",display:"flex",flexDirection:"column",alignItems:"center"},children:(0,s.jsxs)("div",{style:{width:"100%",maxWidth:500,background:"#fff",borderRadius:12,boxShadow:"0 2px 12px rgba(0,0,0,0.10)",padding:"2rem",color:"#222",display:"flex",flexDirection:"column",height:600},children:[(0,s.jsx)("h2",{style:{marginBottom:16,color:"#4f46e5"},children:"Support Chat"}),(0,s.jsxs)("div",{style:{flex:1,overflowY:"auto",marginBottom:16,background:"#f9fafb",borderRadius:8,padding:12,border:"1px solid #eee"},children:[0===r.length?(0,s.jsx)("p",{style:{color:"#888"},children:"No messages yet."}):r.map((e,r)=>(0,s.jsxs)("div",{style:{marginBottom:10,textAlign:"admin"===e.sender?"right":"left"},children:[(0,s.jsx)("div",{style:{fontSize:12,color:"#888",marginBottom:2,textAlign:"admin"===e.sender?"right":"left"},children:"admin"===e.sender?"Admin:":"You:"}),(0,s.jsx)("span",{style:{display:"inline-block",background:"admin"===e.sender?"#4f46e5":"#e0e7ff",color:"admin"===e.sender?"#fff":"#222",borderRadius:16,padding:"0.5rem 1rem",fontWeight:500,maxWidth:"70%",wordBreak:"break-word"},children:e.text})]},r)),(0,s.jsx)("div",{ref:f})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,s.jsx)("input",{type:"text",value:l,onChange:e=>o(e.target.value),placeholder:"Type your message...",style:{flex:1,padding:"0.75rem",borderRadius:8,border:"1px solid #bbb",fontSize:"1rem"},onKeyDown:e=>{"Enter"===e.key&&h()}}),(0,s.jsx)("button",{onClick:h,style:{padding:"0.75rem 1.5rem",background:"#4f46e5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"Send"})]})]})})}},9470:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/purchaser/chats",function(){return t(881)}])}},e=>{var r=r=>e(e.s=r);e.O(0,[636,593,792],()=>r(9470)),_N_E=e.O()}]);